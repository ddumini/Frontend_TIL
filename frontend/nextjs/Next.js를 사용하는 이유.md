# Next.js를 사용하는 이유

## Next.js란?

Vercel 사에서 개발한 React로 만드는 SSR 프레임워크

## 리액트의 한계

기본적으로 순수 리액트는 SPA(Single Page Application)이고, CSR(Client Side Rendering)을 한다.
웹 사이트를 요청할 때 현재 사용하지 않지만 앱에 필요한 모든 컴포넌트를 다운로드하고, 빈 html을 가져와 script를 로딩한다.
이로 인해 앱의 첫 로딩 시간이 오래 걸려 유저 경험을 해치고, SEO에 취약하다는 단점이 있다.

## Next.js의 장점

### 프리렌더링 (pre-rendering)

- 초기 접속 요청이 발생하면 NEXT.js 서버는 접속 경로의 HTML을 [렌더링](../computer-science/rendering/렌더링%20방식.md)하여 클라이언트에 보내준다.
  → FCP(First Contentful Paint)가 빠름
- 후속적으로 현재 페이지의 JS Bundle 파일만 보내주고 사전 렌더링 된 HTML 문서에 JavaScript 코드를 입힌다.
  이를 수화(Hydration)이라고 한다.
- 비로소 유저 인터랙션이 가능해진다. 접속 요청부터 이 때까지 걸리는 시간 지표를 TTI(Time to Interactive)라고 한다.
- 이후 페이지 이동 요청 시 클라이언트 단에서 JS 파일을 실행하여 컴포넌트(페이지)를 교체하는 CSR 방식으로 처리한다.
- 즉, NEXT.js는 React App의 단점인 느린 FCP 문제를 극복하고 빠른 페이지 이동을 승계한다.
- 요청이 들어올 때 마다 사전 렌더링을 진행하므로 항상 최신의 데이터를 유지할 수 있다는 큰 장점이 있지만, 백엔드 서버의 요청과 응답 과정이 딜레이가 길어지는 경우 사용자는 빈 화면만 보고 있어야 한다는 단점도 있다.

### 정적 사이트 생성(static site generation)

- [SSG](../computer-science/rendering/렌더링%20방식.md#3-정적-사이트-생성-ssg)
- 빌드 타임에 미리 페이지를 사전 렌더링됨으로 백엔드 서버의 요청과 응답이 길어져도 사용자 경험에 아무런 영향을 주지 않는다.
- 빌드 타임에 만들어둔 HTML문서를 서빙하고 후속으로 JS Bundle을 전달하여 하이드레이션을 진행한다.
- 즉, 사전 렌더링에 많은 시간이 소요되는 페이지더라도 사용자의 요청에는 매우 빠른 속도로 응답 가능하다.
- 하지만 미리 만들어둔 똑같은 페이지만 매번 응답하므로, 최신 데이터 반영이 어렵다는 단점이 있다.

### 점진적 정적 재생성(incremental static regeneration)

- [ISR](../computer-science/rendering/렌더링%20방식.md#4-점진적-정적-재생성-isr)
- SSG 방식으로 생성된 정적 페이지를 일정 시간을 주기로 다시 생성하는 기술
- 사용자에게 빠른 속도로 응답 가능한 SSG 방식의 장점과 최신 데이터 반영이 가능한 SSR 방식의 장점을 결합한 렌더링 전략이다.

### 프리 페칭(pre-fetching)

현재 페이지에서 이동할 가능성이 있는 모든 페이지를 사전에 불러오는 기능이다.
사전 렌더링 과정에서 모든 페이지의 번들 파일을 전달할 경우 용량이 매우 커져 하이드레이션이 늦어진다.
따라서, 사전 렌더링 시에는 해당 페이지의 JS Bundle만 우선적으로 전달하고 이후 JS Bundle은 프리 페칭하여 전달된다.
유저의 페이지 이동 요청 이후에 JS Bundle을 내려받게 되면 딜레이가 생기므로 이동 할 가능성이 있는 곳의 Bundle을 미리 내려 받는 전략을 사용한다.

- `Link` 컴포넌트를 사용할 때 자동 프리 페칭
- `Link` 컴포넌트의 `prefetch` 속성을 `false`로 해제 가능
- 클라이언트 컴포넌트에서 `router.prefetch('/about');`

### 이미지 최적화

`Image`컴포넌트를 통해 컴포넌트를 통해 자동 이미지 리사이징, 포맷 변환, 지연 로딩, 캐싱 등으로 이미지 최적화를 수행해 페이지 로딩 속도와 사용자 경험을 개선한다.

### Client sid navigation

Link 컴포넌트를 통해 페이지 이동할 때 페이지 전체를 불러오는 것이 아니라 필요한 데이터만 가져오기 때문에 이동 속도도 빨라지고, 넘어가는 동작도 부드럽다.

### 코드 스플리팅

Webpack과 같은 번들러 설정과 import() 문법, lazy, Suspense 사용 없이도 빌드 과정에서 페이지 단위로 자동으로 코드 스플리팅을 지원한다.

### 개발자 경험

파일 시스템 라우팅, 리다이렉트, 스타일링을 위한 환경 설정 등을 제공해 좋은 개발자 경험을 제공한다.
